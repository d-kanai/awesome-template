# 🚀 このワークフローはネイティブアプリのユニットテスト（Jest）を自動実行して品質を保つための設定です
name: Native UT

on:
  # 🔁 main ブランチへの push と Pull Request を監視し、ネイティブコードの変更をカバーする
  push:
    branches: ["main"]
    paths:
      - "frontend_native/**"
  pull_request:
    branches: ["main"]
    paths:
      - "frontend_native/**"

jobs:
  native-ut:
    # 🧪 ジョブ名は「Run native unit tests via pnpm」を採用し、実行内容を明確にする
    name: Run native unit tests via pnpm
    runs-on: ubuntu-latest

    steps:
      # ✅ リポジトリ全体をチェックアウトして後続のステップで利用できるようにする
      - name: Checkout repository
        uses: actions/checkout@v4

      # 📦 プロジェクトで採用している pnpm をセットアップし、バージョン差異を避ける
      - name: Set up pnpm
        uses: pnpm/action-setup@v3
        with:
          version: 9.15.4

      # 🟢 Node.js LTS (22.x) 環境を用意し、pnpm の依存キャッシュを活用してインストールを高速化する
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "22"
          cache: "pnpm"
          cache-dependency-path: frontend_native/pnpm-lock.yaml

      # 🧪 Jest を CI モードで実行し、フロントエンドネイティブのユニットテストを実施する
      - name: Run native unit tests (Jest)
        run: |
          make native-ut
